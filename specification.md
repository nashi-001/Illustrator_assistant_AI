# 漫画家やイラストレーター、及びすべての商業でイラストを製作している人が著作権の侵害を考慮せずに使用できるイラスト製作補助AIの設計仕様書

## 概要

###### 現在時刻

2025/09/22/18/59


### 初めに
最初に、今後は漫画家やイラストレーター、及びすべての商業利用可能なイラスト製作のアシスタントAIを**イラスト製作の補助AI**と呼称します

題名にもある通り、商業作家が使えるイラスト製作のお手伝いができるAIの製作の仕様書です。<br>
「商業作家が使えるAI」として作成する場合、**絶対条件**として以下の条件を守らなければなりません。<br>

1. AIの学習に使用する画像（以後AIの学習データと呼称）
2. AIの出力結果を指定する単語（以後プロンプトと呼称）

この二つに使用するすべての画像、文字等が著作権的な問題のない物、具体的には
1. CC0（著作権放棄された物）
2. CC BY（作者名又はクレジット表記を条件に加工、再配布の利用が可能）
3. 特定の人物、団体と電子的、又は物理的な署名によって、AIの学習、再配布、商業利用を許可された著作物

でなければなりません。<br>


### イラスト製作の補助AIの利用方法

[現在](#現在時刻)は学習モデルを学習データ、著作権の状態と共にすべて CC BY(クレジット表記さえすれば、自由に利用可能)形式での公開を考えております。<br>

API等の連携機能は、AIの性質上、あまり自由に使えません。<br>
具体的には、モデルの精度を落とす代わりに処理速度を向上させる、などはできません<br>

オンラインAPI等を利用したweb、又はAndroid/IOSアプリケーション等は、公開したモデルを元に誰かがサービスを提供してくれることを祈るか、あなたが作ってください、よろしくお願いします。<br>


## イラスト製作の補助AIの機能

AIの機能の流れ

キャンバス情報と前提指示プロンプトの取得 --> AIに渡し扱いやすい数値に変換 --> 現在がどの段階化検査（ラフ、下書き、線画、色塗り、Etc...） --> 数値からキャンバス内の物体、光、キャラ、背景、線、その他さまざまな物を判定 --> 前提指示プロンプトと判定した情報をを元に絵の雰囲気、状況、配色、背景などの共通情報を作成 --> そこから個別の機能へ渡す

詳細

形式

ここでのすべての説明は デフォルトクライアントを利用しており、独自のプログラム/プラグインを利用していない事を前提としております

- 大枠
    - 細かな機能
        - 学習方式 | 具体的な実装/学習方法
        - 学習の前処理 | 必要なマスキングデータ/数値
        - 出力 | 出力データ/データ形式
        - 必要データ | 学習に必要な推定データ、最低限 | 問題なく使えるレベル | 商業作家が使えそうなレベル　の三段階（必要データの推定理論は知らないのでGPTを使用して調べます）
        - 必要データは記載しなくてもよい
        
        - 詳細仕様書へのリンク

<br>

- 線画の補助
    - ラフから線画への変換

        - 学習方式 | ラフとラフを元に清書した線画のセットを用意し、学習させる。

        - 学習の前処理 | ラフと線画を比較したとき、ラフの時点では書かれていたが線画の時点ではなくなった部分を**不必要な部分**とする。<br>
        さらに、ラフと線画両方で頭や腕、胴体などパーツごとに細かくマスキングする。

        - 出力 | [ レイヤー --> ラフ（又は線画） --> ...  --> マスキング名 ]に生成されます。<br>
        レイヤーはパーツごとに細かく分割し生成。<br>
        上記の不必要な部分は胴体、顔等の大枠に分けて[ レイヤー --> ラフ（又は線画） --> ... --> 余分部分 --> 大枠名 ]<br>
        また、色塗りをしやすくするために、線画内を暫定的に背景色と真逆の色（背景色が白の場合は黒、透明の場合はグレー）にしているため、そのままクリッピングを使用しても問題はありません。<br>

        - 推測必要データ | 1000枚 | 10000枚 | 50000枚

        >[線画の補助の詳細設計書](#ラフから線画の詳細設計書)

            

    - 線画のノイズ除去
        - 学習方式 | 線画と、線画に影響しない意味のない点や線などのノイズを追加したセットを用意し、学習させる。
        
        - 学習の前処理 | ノイズの種類ごとにノイズ率を５段階で設定し、マスキングする。

        - 出力 | [ レイヤー --> ノイズ --> 各段階名 ]に生成。

        - 推測必要データ | 1000枚 | 10000枚 | 50000枚

    - 線画の補正 
        - 学習方法 | 線画を崩したり、線の足りない質の悪いと感じる線画と補正後の線画のセットを用意し、学習させる。

        - 学習の前処理 | 線画の線の正確さ、滑らかさ、太さ、統一性、ペンタイプの不一致、不足部分などを設定/マスキングする。

        - 出力 | [ レイヤー --> 線画 --> 修正後レイヤー ]に生成。<br>
        自動修正と指定した画像をグレースケール化したものに寄せるモードがあります。

        - 推測必要データ | 2000枚 | 10000枚 | 100000枚

    - 指定した線画スタイルに類似させる
        - 学習方法 | 特定の一枚の画像とその他の複数の画像を用意し、それぞれの画像との一致率、局部的一致率、雰囲気一致率等の様々な一致率を元に学習させる。

        - 学習の前処理 | 最初に選んだ画像から特徴を取得し、その他の画像との特徴の共通した全体的な雰囲気や、絵柄、構図等のを設定。<br>

        - 出力 | [ レイヤー --> 線画 --> 修正後レイヤー ]に生成。<br>
        この機能は特徴を元にプロンプトを生成し線画の修正に渡します。

        - 推測必要データ | 2000枚 | 20000枚 | 100000枚
    
    - まだあるかもしれないけど現時点では以上


    - 共通の出力 | デフォルトクライアントではない場合は、[オリジナル拡張子](#レイヤー用拡張子)で出力します、専用の変換モジュール又は計算方式を使用してpngなど好きな拡張子に変換してご利用ください


---

- 色彩補助
    - 簡易陰影塗り
        - 学習方法 | 画像をデフォルト、陰影に分けて学習

        - 学習の前処理 | 画像で影のかかっていない部分を、デフォルト、かかっている部分を陰影としてアノテーション、

        - 出力 | 

        - 推測必要データ | 

    - カラー安定化
        - 学習方法 | 

        - 学習の前処理 | 

        - 出力 | 

        - 推測必要データ | 

    - カラートーン変化
        - 学習方法 | 

        - 学習の前処理 | 

        - 出力 | 

        - 推測必要データ | 

    - 光、反射光塗り
        - 学習方法 | 

        - 学習の前処理 | 

        - 出力 | 

        - 推測必要データ | 

    - カラーチェンジ
        - 学習方法 | 

        - 学習の前処理 | 

        - 出力 | 

        - 推測必要データ | 

    - 目のハイライト
        - 学習方法 | 

        - 学習の前処理 | 

        - 出力 | 

        - 推測必要データ | 

---

- 構図立案
    - 構図
        - 学習方法 | 

        - 学習の前処理 | 

        - 出力 | 

        - 推測必要データ | 

    - ポーズ
        - 学習方法 | 

        - 学習の前処理 | 

        - 出力 | 

        - 推測必要データ | 

    - レンズ
        - 学習方法 | 

        - 学習の前処理 | 

        - 出力 | 

        - 推測必要データ | 

    - アタリ
        - 学習方法 | 

        - 学習の前処理 | 

        - 出力 | 

        - 推測必要データ | 

    - 骨格
        - 学習方法 | 

        - 学習の前処理 | 

        - 出力 | 

        - 推測必要データ | 

    - 頭蓋骨
        - 学習方法 | 

        - 学習の前処理 | 

        - 出力 | 

        - 推測必要データ | 

    - 視線
        - 学習方法 | 

        - 学習の前処理 | 

        - 出力 | 

        - 推測必要データ | 
        
    - 光源
        - 学習方法 | 

        - 学習の前処理 | 

        - 出力 | 

        - 推測必要データ | 

    - 場所
        - 学習方法 | 

        - 学習の前処理 | 

        - 出力 | 

        - 推測必要データ | 

    - 物体
        - 学習方法 | 

        - 学習の前処理 | 

        - 出力 | 

        - 推測必要データ | 

    - 方向
        - 学習方法 | 

        - 学習の前処理 | 

        - 出力 | 

        - 推測必要データ | 

    - カメラ

        - 学習方法 | 

        - 学習の前処理 | 

        - 出力 | 

        - 推測必要データ | 

---

- 服・小物
    - 服の種類
        - 学習方法 | 

        - 学習の前処理 | 

        - 出力 | 

        - 推測必要データ | 

    - 服の長さ
        - 学習方法 | 

        - 学習の前処理 | 

        - 出力 | 

        - 推測必要データ | 

    - 服の色
        - 学習方法 | 

        - 学習の前処理 | 

        - 出力 | 

        - 推測必要データ | 

    - フリル
        - 学習方法 | 

        - 学習の前処理 | 

        - 出力 | 

        - 推測必要データ | 

    - 装飾
        - 学習方法 | 

        - 学習の前処理 | 

        - 出力 | 

        - 推測必要データ | 

    - 服のしわ
        - 学習方法 | 

        - 学習の前処理 | 

        - 出力 | 

        - 推測必要データ | 

    - 小物生成
        - 学習方法 | 

        - 学習の前処理 | 

        - 出力 | 

        - 推測必要データ | 

    - デザイン変更
        - 学習方法 | 

        - 学習の前処理 | 

        - 出力 | 

        - 推測必要データ | 

    - ひねり
        - 学習方法 | 

        - 学習の前処理 | 

        - 出力 | 

        - 推測必要データ | 

---

- 背景
    - 遠近レベル

    - 背景生成

    - 背景染色

    - 天候

    - 伏線の位置

    - 視線誘導

    - ぼかし

---

- 補正・修正
    - 線画修正

    - 塗り修正

    - サイズ修正

    - 遠近レベル調整

    - 設定相違部分検出

    - レイヤー分け

    - カラー提案

        - 学習方法 | 

        - 学習の前処理 | 

        - 出力 | 

        - 推測必要データ | 


## AI機能のプログラム的仕様

初めに、今後記述するもので、変数名などが長いものを先に先にこの場で短縮させていただきます。<br>

##### IA_API = illustrator_assistant_AI_API



### すべての現時点での製作する予定のAI



### AIを使用するまでの詳細な手順書

AIに出来る入力は学習の統一性を保つため制限されています。<br>
出力データもすべて一部既存のものとは違うデータで渡す可能性があるため、AIを利用する場合は注意してください<br>


#### AIへの入力から出力までのフローチャート


#### 特徴抽出

```
返却された構造体_1 = illust_assistant_ai.最大レベル物体抽出(画像、絶対条件、もしあるなら過去データ);

返却された構造体_1 = {
    "セッション_ID": int 0~65535のどれかと、int 0のペア;
    "オブジェクト": vector [x座標]の[y座標]に(#RRBBGGAA、物体);
    "絶対条件": 絶対条件;
}

物体情報_1 = defalt_client.adjust(返却された構造体)

物体情報_1 = {
    "セッション_ID": int 上記のものを引き継ぐ、 int 1;
    "オブジェクトID": vector配列、[オブジェクトID]に[y,[x, x, x]]がある;
    "色塗り用レイヤー": オブジェクトIDの範囲をすべて#fffffa20色にしたもの;
    "絶対条件": 絶対条件;
}

返却された構造体_2 = illust_assistant_ai.中級レベル物体抽出(物体情報_1から色塗りレイヤーを除いたもの)

返却された構造体_2 = {
    "セッションID": int 上記のものを引き継ぐ、 int 2;
    "オブジェクトID": vector配列、[オブジェクトID]に[サブオブジェクト],その中に座標情報;
}

物体情報_2 = ...

物体情報_ 3= {
    "セッションID": ...;
    "オブジェクト": 人体の場合は目や耳、髪の毛、手といったレベルまで;
}

物体情報_4 = {
    "オブジェクト": さらに目のハイライト、耳の形、手の関節などまでレイヤー分け
}

```
上記のコードは`return_struct`や`return_adjust`は人間や背景、建物を検出し、形を整えてまたAIに渡す...といったことを繰り返す関数群です。<br>
最初にこれを使用する、又はプロジェクト再起動後初めて使用する、又は過去データがない場合は`return_struct1`のデータを一時メモリ、またはファイルに保存して今後のAIによる物体検出を減らして、軽量化を図ります。<br>

ここでいう過去データとはデフォルトクライアントの場合は生成した後、そのレイヤー又は設定によっては正規化後の胴体エリアなどで加筆修正が行われていないか等のデータを指します。<br>
もし過去データがあり、問題ないと判断されれば`return_struct1`をスキップして効率化を図ります。<br>

絶対条件とは物体を検出する際、**耳から生えているタコ**、**類似させてほしい自分の特徴的な線画**等の無くしたくない情報や、特定のものだけ別のレイヤーに入れたい情報を入力することでそのように認識してくれる機能です、おそらく実装するのはほとんどの機能が作成されてからなので、かなり後になると思いますが、お待ちください。<br>

--- 

#### AIモジュールに渡す

[上記の機能](#特徴抽出)で抽出した`物体情報 + サイズ番号`を線画補正、構図提案等の個別AIに渡します。

```

線画補正の"ラフから線画"AIの場合は
illust_assistant_ai.convert_rough_to_line_art(物体情報_3, 絶対条件, レイヤー分け)
です。

物体情報_3は人間 --> 頭 --> 目、までの情報を含みます。
絶対条件は類似する線画の情報、線画の印象（やわらかい、キリっとした、写実的、Etc...）を設定したものです。
レイヤー分けは線画を物体情報_3まで細かくレイヤーに分ける機能です、デフォルトでは無効設定になっています。

生成を行う個別AIに渡す変数は基本的に上記の三つのプロンプトです。

```

イラストの製作中の補正、特定位置の線画の強弱の補正、服に刺繍などを追加した際の自動レイヤー分けなどは動的な個別AIです。<br>
渡す値は
`illust_assistant_ai.layer_division_assist(物体情報_1から4, イラスト情報, 直近の描画情報, 絶対条件)`

です。<br>
物体情報_1から3はどこで書いているかを取得し、それをも元に書かれているものの可能性として何があるかの選択肢を狭めています。<br>
イラスト情報は絶対条件と類似しています、具体的な内容は全体図からわかる範囲でポップ、ミニキャラ等の情報から選択肢を狭めています。<br>
直近の描画情報は、筆のサイズ、色、描画位置の情報がある履歴が30行動分必要です。<br>
絶対条件は本来あるはずのないものかどうかを判定し、適切な場所にレイヤーを配置できるようにするための情報です。<br>

--- 



### send_canvas_env
キャンバス情報を取得し、その情報を情報整理APIに渡します、引数は一行下です<br>

IA_API.send_canvas_env<br>
| 必要な引数 | 渡す値の型 |
|----|----|
| canvas_name | string |
| canvas_size(幅、高さ) | tuple |
| [canvas_info](#send_canvas_env_canvas_info) | struct |
| [illust_imagine](#send_canvas_env_illust_imagine) | list or string or nullptr |



###### send_canvas_env_canvas_info
canvas_infoのstruckの中身は<br>
```
{
    "canvas_image": image_file_path 又は image_array 又は [.iaaipファイル](#iaaip);
    "canvas_layer": {
        layers: { any_layer_folder_name :{layer_1, layer_2, ...};,
                { any_layer_folder_name :{layer_1, layer_2, ...};,
                ...
        };
    } 又は [.iaaipファイル](#iaaip);
    "canvas_color": [canvas_background_color, using_color1, using_color2, ...], 又は [.iaaipファイル](#iaaip);
}
```

###### send_canvas_env_illust_imagine

前提として、AIに渡すイラストイメージは単語で区切ってください、`髪を黒長にして腰かお腹あたりまでカーブするように伸ばして` といった指示はできません。<br>
単一ワード内で単語を区切りたい場合は ` "_" 又は "＿" 又は "-" 又は "ー" `の四つを使用できます、それ以外はエラーになるまで

listで渡す場合は単一ワード内でも単語ごとに分けてください、例えば<br>
` ["長髪", "ロングヘア", "髪_長く", "髪_腰_まで", "hair_length_50"] `<br>
このようにして渡してください。<br>

stringで果たす場合は `"、"又は "," ` で単語を区切ってください、例えば<br>
` "長髪,ロングヘア、髪_長く,髪＿腰＿まで、hair_length_50" `<br>
です、stringの場合はワード分けができていないと[エラー](#error_invalid_word)を返却します。

nullptr（デフォルト）の場合はcanvas_infoで取得した情報から特徴を抽出し、そこから自動で生成を行います。


### 線画の詳細設計書

#### ラフから線画の詳細設計書
- ラフから線画のマスキングは<br>
    マスキングの大枠 [髪、目、顔、首、胴体、腕、手、脚、足、枠内]<br><br>
    マスキングの中枠 [頭のテッペン、前髪、横髪、後髪、眉毛、右目、左目、眉、耳、鼻、口ひげ、口、ひげ、首、右肩、左肩、右胸、左胸、右腹、左腹、右上腕、左上腕、右二の腕、左二の腕、右手首、左手首、右掌、左掌、右手の甲、左手の甲、親指、人差し指、中指、薬指、小指、腰、股間、右大腿、左大腿、右膝、左膝、右下腿、左下腿、右足首、左足首、右足の甲、左足の甲、右足の裏、左足の裏、足親指、足人差し指、足中指、足薬指、足小指]<br><br>
    マスキングの小枠 [前頭部、後頭部、頭頂部中心、左前髪、中央前髪、右前髪、左横髪、右横髪、左後髪、中央後髪、右後髪、左もみあげ、右もみあげ、左眉上、左眉下、右眉上、右眉下、左目白目、左瞳、左まつ毛、右目白目、右瞳、右まつ毛、左眉、右眉、左耳前、左耳後、右耳前、右耳後、鼻頭、鼻筋、鼻翼左、鼻翼右、鼻下ひげ、顎ひげ、頬ひげ、上唇、下唇、口内、歯、舌、首前面、首側面左、首側面右、首後面、上右胸、下右胸、上左胸、下左胸、上右腹、下右腹、上左腹、下左腹、右背中、中央背中、左背中、左腰、右腰、右上腕前面、右上腕側面、右上腕後面、左上腕前面、左上腕側面、左上腕後面、右二の腕前面、右二の腕側面、右二の腕後面、左二の腕前面、左二の腕側面、左二の腕後面、右肩前、右肩後、左肩前、左肩後、右手首前面、右手首後面、左手首前面、左手首後面、右手の掌中心、右手の掌指付け根、左手の掌中心、左手の掌指付け根、右手の甲中央、右手の甲左側、右手の甲右側、左手の甲中央、左手の甲左側、左手の甲右側、右親指関節1、右親指関節2、右親指関節3、左親指関節1、左親指関節2、左親指関節3、右人差し指関節1、右人差し指関節2、右人差し指関節3、左人差し指関節1、左人差し指関節2、左人差し指関節3、右中指関節1、右中指関節2、右中指関節3、左中指関節1、左中指関節2、左中指関節3、右薬指関節1、右薬指関節2、右薬指関節3、左薬指関節1、左薬指関節2、左薬指関節3、右小指関節1、右小指関節2、右小指関節3、左小指関節1、左小指関節2、左小指関節3、右大腿前面、右大腿側面、右大腿後面、左大腿前面、左大腿側面、左大腿後面、右膝前面、右膝側面、右膝後面、左膝前面、左膝側面、左膝後面、右下腿前面、右下腿側面、右下腿後面、左下腿前面、左下腿側面、左下腿後面、右足首前面、右足首後面、右足首側面、左足首前面、左足首後面、左足首側面、右足の甲中央、右足の甲左側、右足の甲右側、左足の甲中央、左足の甲左側、左足の甲右側、右足裏土踏まず、右足裏かかと、右足裏指付け根、左足裏土踏まず、左足裏かかと、左足裏指付け根、右足親指関節1、右足親指関節2、右足親指爪、左足親指関節1、左足親指関節2、左足親指爪、右足人差し指関節1、右足人差し指関節2、右足人差し指爪、左足人差し指関節1、左足人差し指関節2、左足人差し指爪、右足中指関節1、右足中指関節2、右足中指爪、左足中指関節1、左足中指関節2、左足中指爪、右足薬指関節1、右足薬指関節2、右足薬指爪、左足薬指関節1、左足薬指関節2、左足薬指爪、右足小指関節1、右足小指関節2、右足小指爪、左足小指関節1、左足小指関節2、左足小指爪]<br>
    です、不必要な部分のマスキングはマスキングの大枠の範囲に入っていればそれに応じたレイヤーを作成し、そこにすべて保存します。<br>
    もしマスキングの大枠の外の場合はすべて"out_range"レイヤーに保存します<br>
    不必要部分のマスキング内容はマスキングの大枠に追加して [枠外]です<br>

    今後はマスキング範囲、種類は本ファイルの下の方に配置し、別の大枠でもその個所を参照します



    - 出力 | デフォルトクライアントの場合はそのまま下記の1に記述されている箇所に保存されます。<br>
    レイヤーはパーツごとに細かく分割し、上記の不必要な部分も胴体、顔等大枠毎に分けて生成<br>
    また、色塗りをしやすくするために、線画内を暫定的に背景色と真逆の色（背景色が白の場合は黒、透明の場合はグレー）にしているため、そのままクリッピングを使用しても問題はありません<br>
    - デフォルトクライアントを利用している場合

        1. ラフの中央前髪場合 | レイヤー --> ラフ（又は線画） --> 髪（大枠） --> 前髪（中枠） --> 中央前髪（小枠）にマスキング名のまま保存されます。

        2. 保存時は[専用システム](#フォルダファイル管理システム)を使用してください。<br>
        引数は[ファイルのパス、ファイル名、アイテムの種類、アイテムの解像度、同プロジェクト内での総作成回数、同プロジェクト内での個別アイテムの総作成回数、アイテム生成の参照画像、現在時刻、アイテムの位置、ファイルサイズ] おそらくまだ追加するべき項目はありますが、現時点ではこれです

        3. 保存時には毎回そのファイルが既にフォルダ内にあるかないかを調べ、ない場合はそのまま保存、存在する場合は以下の方法を実行してください。<br>

        4. 保存時は[専用システム](#フォルダファイル管理システム)を使用し、<br>
        `マスキング名 + フォルダ内に既に存在しているファイル数+1 + .iaail`<br>
        で保存されます、もしそのフォルダ名が存在している場合、フォルダ内に存在しているファイル内で、マスキング名 + フォルダ内で最大の数値+1 + .iaalに保存します。（この数値は1byteで利用するため、あまり無茶な利用はしないでください）<br>

        5. それでもまだ存在する場合はrandomモジュールを使用し、<br>
        `マスキング名 + フォルダ内に既に存在しているファイル数+1 + _random生成された整数(0から65535の範囲)_ + .iaal` <br>
        を20回ほど実行します、それでもダメな場合はエラーを吐きます。（エラー文 --> ファイルを保存できませんでした）

## デフォルトクライアント



### レイヤー

### フォルダ/ファイル管理システム

## オリジナル拡張子

### .iaail
    読み方はiaail（あいえーあいえる、又はいあある、又はイアレイヤーです）

### .iaaip
    読み方はiaaip（あいえあいぴー、又はいああぴ、又はイアプロジェクトです）

### レイヤー用拡張子


## 仕様ライブラリ
